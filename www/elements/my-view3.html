<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="shared-styles.html">

<link rel="import" href="global-services.html">

<dom-module id="my-view3">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;
      }

      iron-form {
        padding: 20px;
        display: table;
      }

      paper-input, paper-button{
        float: left;
        margin: 0px 30px;
      }

      paper-input {
        min-width: 100px;
      }

      paper-button {
        width:100px
      }

      h3{
        float: left;
      }

    </style>

    <div class="card">
      <div class="">策略参数设置</div>
      <iron-form id="TaskConfigForm">
        <form>
          <div>
            <paper-input name="coin" type="" placeholder="货币名称(btc, ltc...)" value="{{coinName}}" required no-label-float></paper-input>
            <paper-input name="open" type="" placeholder="开仓差价百分比" value="{{open}}" required no-label-float>
              <div slot="suffix">%</div>
            </paper-input>
            <paper-input name="close" type="" placeholder="平仓差价百分比" value="{{close}}" required no-label-float>
              <div slot="suffix">%</div>
            </paper-input>
          </div>
          <div>
            <paper-input name="openlimit" type="" placeholder="开仓允许价差" value="{{openlimit}}" required no-label-float>
              <div slot="suffix">%</div>
            </paper-input>
            <paper-input name="clostlimit" type="" placeholder="强制平仓波动" value="{{closelimit}}" required no-label-float>
              <div slot="suffix">%</div>
            </paper-input>
          </div>
        <paper-button raised="true" on-click="dialogConfirm">Start</paper-button>
        </form>
      </iron-form>
    </div>
    <paper-dialog id="actions">
      <h2>确认配置</h2>
      <p>货币 {{coinName}} 开仓差价百分比{{open}}% 平仓差价百分比{{close}}% 开仓允许价差{{openlimit}}% 强制平仓波动{{closelimit}}%</p>
      <div class="buttons">
        <paper-button dialog-dismiss>取消</paper-button>
        <paper-button dialog-confirm autofocus on-click="accept">确定</paper-button>
      </div>
    </paper-dialog>
    <div class="card">
      <div>
        <h2>策略输出日志</h2>
        <pre>[[log]]</pre>
      </div>
    </div>
    <global-services id="globalServices"></global-services>
    <iron-ajax
      url="http://localhost:8080/task/start"
      body="{{config}}"
      method="post"
      content-type="application/json"
      on-response="handleResponse"
      debounce-duration="300" id="ajax"></iron-ajax>
  </template>

  <script>
    class MyView3 extends Polymer.Element {
      static get is() { return 'my-view3'; }
      static get properties(){
        return {
          coinName: {
            type: String,
            value: "ltc",
          },
          config:{
            type: String,
          },
          open: Number,
          close: Number,
          openlimit: Number,
          closelimit: Number,
          log: {
            type: String,
            value: "",
          }
        };       
      }

      dialogConfirm(){
        this.$.actions.open()
      }

      accept(){
        console.log("accept")
        this.config = "{\"area\":{\"ltc\":{\"start\":3, \"close\":1.5}}, \"limitclose\":0.03, \"limitopen\":0.005}"
        this.$.ajax.generateRequest()
        this.$.globalServices.WebsocketAddListener("test", function(message){
          this.log += (message + "\n")
        }.bind(this))
      }

      handleResponse(){
        console.log("response")
      }
    }

    window.customElements.define(MyView3.is, MyView3);
  </script>
</dom-module>
